<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://api.fontshare.com/v2/css?f[]=space-grotesk@400,500,600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0a0a0a;
            color: #fafafa;
        }
        .card {
            background-color: #171717;
            border: 1px solid #262626;
            transition: all 0.2s ease;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        .card:hover {
            border-color: #404040;
        }
        .chart-container {
            width: 100%;
            height: 400px;
        }
        .text-gray-400 {
            color: #9ca3af;
        }
        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem;
        }
        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem;
        }
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }
        .font-medium {
            font-weight: 500;
        }
        .mb-1 {
            margin-bottom: 0.25rem;
        }
        .mb-4 {
            margin-bottom: 1rem;
        }
        .mb-8 {
            margin-bottom: 2rem;
        }
        .container {
            max-width: 72rem;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-medium mb-8">Traffic Analysis Dashboard</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card">
                <p class="text-sm text-gray-400 mb-1">Total Accidents</p>
                <p class="text-3xl font-medium">{{ metrics['total_accidents'] | format_number }}</p>
            </div>
            <div class="card">
                <p class="text-sm text-gray-400 mb-1">Active Licenses</p>
                <p class="text-3xl font-medium">{{ metrics['total_licenses'] | format_number }}</p>
            </div>
            <div class="card">
                <p class="text-sm text-gray-400 mb-1">Registered Vehicles</p>
                <p class="text-3xl font-medium">{{ metrics['total_vehicles'] | format_number }}</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="card">
                <h2 class="text-lg font-medium mb-4">Yearly Accident Trends</h2>
                <div id="accidents-trend" class="chart-container"></div>
            </div>
            <div class="card">
                <h2 class="text-lg font-medium mb-4">Nationality Distribution</h2>
                <div id="nationality-distribution" class="chart-container"></div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-lg font-medium mb-4">Hourly Accident Distribution</h2>
            <div id="hourly-pattern" class="chart-container"></div>
        </div>
    </div>

    <script>
        // Create the charts when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            const accidentsTrend = JSON.parse('{{ accidents_trend | safe }}');
            const nationalityDist = JSON.parse('{{ nationality_dist | safe }}');
            const hourlyPattern = JSON.parse('{{ hourly_pattern | safe }}');
            
            // Create the charts
            Plotly.newPlot('accidents-trend', 
                accidentsTrend.data, 
                accidentsTrend.layout,
                {responsive: true}
            );
            
            Plotly.newPlot('nationality-distribution', 
                nationalityDist.data, 
                nationalityDist.layout,
                {responsive: true}
            );
            
            Plotly.newPlot('hourly-pattern', 
                hourlyPattern.data, 
                hourlyPattern.layout,
                {responsive: true}
            );
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            Plotly.Plots.resize('accidents-trend');
            Plotly.Plots.resize('nationality-distribution');
            Plotly.Plots.resize('hourly-pattern');
        });
    </script>
</body>
</html>
